# üóÑÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê S3 –•–†–ê–ù–ò–õ–ò–©–ê

## üì¶ –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä:** Timeweb Cloud Storage (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)  
**Endpoint:** `https://s3.twcstorage.ru`  
**–†–µ–≥–∏–æ–Ω:** `ru-1`  
**Bucket:** `26bf6ecb-2b26c15a-8629-4e9f-9eaf-009a5b88dd96`

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –≤ –±–∞–∫–µ—Ç–µ

```
bucket/
‚îú‚îÄ‚îÄ tours/
‚îÇ   ‚îú‚îÄ‚îÄ covers/          # –û–±–ª–æ–∂–∫–∏ —Ç—É—Ä–æ–≤ (1200x800px)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ {timestamp}-{random}.jpg
‚îÇ   ‚îú‚îÄ‚îÄ gallery/         # –§–æ—Ç–æ –≥–∞–ª–µ—Ä–µ–∏ —Ç—É—Ä–æ–≤ (1920x1080px)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ {timestamp}-{random}.jpg
‚îÇ   ‚îî‚îÄ‚îÄ videos/          # –í–∏–¥–µ–æ —Ç—É—Ä–æ–≤ (mp4, webm)
‚îÇ       ‚îî‚îÄ‚îÄ {timestamp}-{random}.mp4
‚îî‚îÄ‚îÄ users/
    ‚îî‚îÄ‚îÄ avatars/         # –ê–≤–∞—Ç–∞—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (500x500px)
        ‚îî‚îÄ‚îÄ {timestamp}-{random}.jpg
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏

- `@aws-sdk/client-s3` - SDK –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å S3
- `@aws-sdk/s3-request-presigner` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö URL

### –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

1. **`lib/s3/client.ts`** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è S3 –∫–ª–∏–µ–Ω—Ç–∞
2. **`lib/s3/upload.ts`** - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏/—É–¥–∞–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
3. **`app/api/upload/route.ts`** - API endpoint –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
4. **`app/api/upload/delete/route.ts`** - API endpoint –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
5. **`components/admin/FileUploader.tsx`** - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ API

–¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—è–º–∏:
- `super_admin` - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
- `tour_admin` - –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å/—É–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã —Ç—É—Ä–æ–≤

### –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

**–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
- –§–æ—Ä–º–∞—Ç—ã: `image/jpeg`, `image/jpg`, `image/png`, `image/webp`
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB

**–í–∏–¥–µ–æ:**
- –§–æ—Ä–º–∞—Ç—ã: `video/mp4`, `video/webm`
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB (–º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å –¥–ª—è –≤–∏–¥–µ–æ)

### ACL (Access Control List)

–í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç `ACL: 'public-read'` - –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –ø—Ä—è–º–æ–º—É URL

## üì° API Endpoints

### POST `/api/upload`

–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª –≤ S3

**Body (FormData):**
```typescript
{
  file: File,           // –§–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
  type: string          // 'tour-cover' | 'tour-gallery' | 'tour-video' | 'avatar'
}
```

**Response:**
```typescript
{
  success: true,
  url: string,          // –ü—É–±–ª–∏—á–Ω—ã–π URL —Ñ–∞–π–ª–∞
  path: string,         // –ü—É—Ç—å –≤ –±–∞–∫–µ—Ç–µ
  fileName: string      // –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
}
```

### POST `/api/upload/delete`

–£–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª –∏–∑ S3

**Body (JSON):**
```typescript
{
  path: string          // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤ –±–∞–∫–µ—Ç–µ
}
```

**Response:**
```typescript
{
  success: true,
  message: string
}
```

## üé® –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

### –ü—Ä–∏–º–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞

```typescript
import FileUploader from '@/components/admin/FileUploader';

function TourForm() {
  const handleUploadComplete = (url: string, path: string) => {
    console.log('–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω:', url);
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
  };

  return (
    <FileUploader
      type="tour-cover"
      onUploadComplete={handleUploadComplete}
      accept="image/*"
      maxSizeMB={10}
    />
  );
}
```

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ S3

```typescript
import Image from 'next/image';

function TourCover({ imageUrl }: { imageUrl: string }) {
  return (
    <Image
      src={imageUrl}  // URL –∏–∑ S3
      alt="Tour cover"
      width={1200}
      height={800}
      className="rounded-lg"
    />
  );
}
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ S3

1. ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
2. ‚úÖ **CDN** - –±—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
3. ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** - 99.99% uptime
4. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
5. ‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è** - —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–≥—Ä—É–∂–∞—é—Ç —Å–µ—Ä–≤–µ—Ä Next.js
6. ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **–†–∞–∑–º–µ—Ä –±–∞–∫–µ—Ç–∞:** –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ø–∞–Ω–µ–ª–∏ Timeweb
- **–¢—Ä–∞—Ñ–∏–∫:** –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∞—Ä–∏—Ñ–∞ Timeweb

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –¥—Ä—É–≥–æ–π S3 –ø—Ä–æ–≤–∞–π–¥–µ—Ä:

1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–∫–µ—Ç–∞
2. –ò–∑–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (endpoint, credentials)
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã –≤ –Ω–æ–≤—ã–π –±–∞–∫–µ—Ç
4. –û–±–Ω–æ–≤–∏—Ç—å URL –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∫–µ—Ç–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

1. **CORS** - —Ä–∞–∑—Ä–µ—à–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –¥–æ–º–µ–Ω–∞ —Å–∞–π—Ç–∞
2. **Lifecycle** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. **Versioning** - —Ö—Ä–∞–Ω–∏—Ç—å –≤–µ—Ä—Å–∏–∏ —Ñ–∞–π–ª–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. **Backup** - —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

