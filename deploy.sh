#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
SERVER="root@92.53.99.60"
PROJECT_DIR="/var/www/tatarstan-tours"

echo "üöÄ –ù–∞—á–∏–Ω–∞—é –¥–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
ssh $SERVER << 'ENDSSH'
cd /var/www/tatarstan-tours
echo "üì• –ü–æ–ª—É—á–∞—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ GitHub..."
git pull origin main
echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏..."
npm install
echo "üî® –°–æ–±–∏—Ä–∞—é –ø—Ä–æ–µ–∫—Ç..."
npm run build
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PM2..."
pm2 restart tatarstan-tours || pm2 start npm --name "tatarstan-tours" -- start
pm2 save
echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à—ë–Ω!"
echo "üìä –°—Ç–∞—Ç—É—Å PM2:"
pm2 status
ENDSSH

echo "‚ú® –ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–≤–µ—Ä—å http://92.53.99.60:3000"
